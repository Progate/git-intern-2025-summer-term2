# E2E (End-to-End) Tests

このディレクトリには、mygitコマンドのE2Eテストが含まれています。

## 目的

E2Eテストは、実際のユーザーの使い方と同じようにコマンドを実行し、システム全体の動作を確認します。

- 実際のファイルシステムを使用
- .gitディレクトリの読み書き
- コマンドライン引数の処理
- 標準出力/標準エラー出力の確認

## テストケース一覧

### mygit log コマンド

1. **正常系**

   - 複数のコミット履歴を表示
   - 単一のコミット履歴を表示
   - コミット情報の表示形式確認（SHA, 作者, 日時, メッセージ）

2. **エラー系**

   - .gitディレクトリが存在しない場合
   - HEADファイルが存在しない場合
   - コミットが存在しない場合（空のリポジトリ）
   - 壊れたGitオブジェクトがある場合

3. **境界値**
   - マージコミット（複数の親を持つコミット）
   - 長いコミットメッセージ
   - 特殊文字を含むコミットメッセージ

## 実行方法

### 前提条件

- Node.js とnpmがインストールされていること
- プロジェクトの依存関係がインストールされていること（`npm install`）
- TypeScriptがビルドされていること（`npm run build`）

### 個別テスト実行

```bash
# 特定のテストファイルを実行
npx jest tests/e2e/log.e2e.test.ts

# 特定のテストケースを実行
npx jest tests/e2e/log.e2e.test.ts -t "複数のコミット履歴を表示"
```

### 全E2Eテスト実行

```bash
# e2eディレクトリ内の全テストを実行
npx jest tests/e2e/

# カバレッジレポートも生成
npx jest tests/e2e/ --coverage
```

### 詳細ログ付き実行

```bash
# デバッグ情報を含めて実行
npx jest tests/e2e/ --verbose
```

## テスト環境

- 各テストは独立した一時ディレクトリで実行されます
- テスト用のGitリポジトリが自動的に作成・削除されます
- 実際のgitコマンドを使用してテストデータを準備します

## 注意事項

- E2Eテストは実際のファイルシステムを使用するため、実行時間がかかる場合があります
- テスト実行中は一時ファイルが作成されますが、テスト終了後に自動削除されます
- 並列実行時に競合状態が発生しないよう、各テストは独立したディレクトリを使用します

## 現状のテスト対応状況（2025/08/28時点）

### 対応できているケース

- 複数のコミット履歴を表示（正常系）
- 単一のコミット履歴を表示（正常系）
- 長いコミットメッセージの表示（正常系）
- 特殊文字を含むコミットメッセージの表示（正常系）
- .gitディレクトリが存在しない場合（エラー系）
- HEADファイルが存在しない場合（エラー系）
- 作者名に特殊文字が含まれる場合（境界値）

### 対応できていない/失敗するケース

- 空のリポジトリの場合（コミットが存在しない）
  - テスト失敗。コミットがない場合の出力やエラー処理が不十分。
- マージコミット（複数の親を持つコミット）
  - テスト失敗。mainブランチが存在しないため checkout main でエラー。
- 空のコミットメッセージ
  - テスト失敗。gitの仕様で空メッセージのコミットは作成できない。

### 備考

- すべてのケースに完全対応しているわけではありません。
- gitコマンドの仕様や初期ブランチ名（master/main）による影響があります。
- 境界値やエラー系は今後の実装・仕様変更で対応可能です。

### 実装上の問題（マージコミット関連）

- マージコミット（複数の親を持つコミット）テストは、ブランチ名の修正でセットアップは成功するが、
  mygit logコマンドの出力が期待通りにならず、アサーションで失敗する。
- これは、実装側でマージコミット（親が複数あるコミット）の履歴取得・表示ロジックが十分でない可能性がある。
- 具体的には、親コミットの辿り方や履歴の順序、表示内容がGitの仕様と異なる場合がある。
- 今回はこの部分の実装改修は行わないため、テスト・実装の変更は不要。
